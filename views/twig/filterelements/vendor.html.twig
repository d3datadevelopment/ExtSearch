{% set sIdKey = "vendor" %}
{% set blShowMultipleSelector = true %}
<div class="item vendor {{ cssclass }}" id="atid_vendor">
    {% block d3_inc_ext_search__filter_vendor_title %}
        <label for="searchvendor">
            {{ translate({ ident: "D3_EXTSEARCH_EXT_VENDORS" }) }}
        </label><br>
    {% endblock %}

    {% set displayTypes = { "combined": "combined", "single": "single" } %}

    {% if $sVendorFilterDisplayType in displayTypes %}
        {% block d3_inc_ext_search__filter_vendor_single %}
            <SELECT class="form-select" id="searchvendor" name="searchvendor" onchange="d3_extsearch_popup.popup.load(); this.form.submit();">
                {% if sSelectedVendorId %}
                    {% set blShowMultipleSelector = false %}
                    <OPTION class="desc" value="">{{ translate({ ident: "D3_EXTSEARCH_EXT_SEARCHINVENDORS" }) }}</OPTION>
                    <OPTION value="{{ sSelectedVendorId }}" selected="selected">{{ sSelectedVendor }}</OPTION>
                {% else %}
                    <OPTION class="desc" value="" selected="selected">{{ translate({ ident: "D3_EXTSEARCH_EXT_CHOOSEVENDOR" }) }}</OPTION>
                    {% for vendor in oView.d3getVendorList() %}
                        <OPTION value="{{ vendor.getId() }}">{{ vendor.oxvendor__oxtitle.getRawValue() }}
                            {% if not oModCfg_d3_extsearch.getValue('blExtSearch_dontShowFilterArticleCount') and vendor.getFieldData('counter') %}
                                ({{ vendor.getFieldData('counter') }})
                            {% endif %}
                        </OPTION>
                    {% endfor %}
                {% endif %}
            </SELECT>

            <noscript>
                <div id="searchvendorsubmit" class="fullitem">
                    <button type="submit" class="submitButton largeButton btn {% if oModCfg_d3_extsearch.isThemeIdMappedTo('wave') %}btn-outline-primary {# for Bootstrap 4 #}{% endif %} btn-sm" onclick="d3_extsearch_popup.popup.load();">{{ translate({ ident: "D3_EXTSEARCH_EXT_ASSIGNFILTER" }) }}</button>
                </div>
            </noscript>
        {% endblock %}
    {% endif %}

    {% set displayTypes = { "combined": "combined", "multi": "mutli" } %}

    {% if $sVendorFilterDisplayType in displayTypes %}
        {% block d3_inc_ext_search__filter_vendor_multi %}
            <div class="multiselect" id="d3searchvendor__multi" style="{% if sVendorFilterDisplayType == 'combined' %}display: none;{% endif %}">
                {% for valuekey, vendor in oView.d3getVendorList() %}
                    <div class="multiselectvalue" id="d3searchvendor__multi__{{ valuekey }}">
                        <input name="d3searchvendormulti[{{ vendor.getId() }}]" type="hidden" value="">
                        <input name="d3searchvendormulti[{{ vendor.getId() }}]" type="checkbox" class="form-check-input" value="{{ vendor.getId() }}" id="cb{{ key }}{{ vendor.getId() }}" {% if vendor.selected or vendor.getId() == sSelectedVendorId %} checked{% endif %}>
                        <label for="cb{{ key }}{{ vendor.getId() }}">
                            {{ vendor.getTitle() }} {% if not oModCfg_d3_extsearch.getValue('blExtSearch_dontShowFilterArticleCount') and vendor.getFieldData('counter') %}({{ vendor.getFieldData('counter') }}){% endif %}
                        </label>
                    </div>
                {% endfor %}

                {% block d3_inc_ext_search__filter_vendor_multibuttons %}
                    {% include "@d3_extsearch/filterelements/inc/multibuttons.html.twig" with {type: "vendor"} %}
                {% endblock %}
            </div>
        {% endblock %}
    {% endif %}

    {% block d3_inc_ext_search__filter_vendor_multiselector %}
        {% if sVendorFilterDisplayType == 'combined' %}
            <div id="d3searchvendor__multiselector" class="filterselector {% if false == blShowMultipleSelector %}filterselector_hidden{% endif %}">
                <input type="checkbox" class="form-check-input" name="d3searchvendormultiselector" id="d3searchvendormultiselector" onclick="toggleMultiVendor(this.checked);">
                <label for="d3searchvendormultiselector">
                    {% set vendortranslation = "VENDOR"|translate %}
                    {{ oView.d3GetMultipleSelectionTranslation(vendortranslation) }}
                </label>
            </div>

            {% set d3JsFnc %}{% apply spaceless %}
                function toggleMultiVendor(blChecked) {
                    if (blChecked) {
                        document.getElementById('d3searchvendor__multi').style.display = 'block';
                        document.getElementById('searchvendor').style.display = 'none';
                        if (buttonElement = document.getElementById('searchvendorsubmit')) {
                            buttonElement.style.display = 'none';
                        }
                        document.getElementById('d3searchvendor__multiselector').style.display = 'none';
                    }
                }
            {% endapply %}{% endset %}
            {{ script({ add: d3JsFnc.__toString(), dynamic: __oxid_include_dynamic }) }}

            {% if oView.d3VendorFilterUseMultipleValues() %}
                {% set d3JsFnc %}{% apply spaceless %}
                    toggleMultiVendor(true);
                    document.getElementById('d3searchvendormultiselector').checked = 'checked';
                {% endapply %}{% endset %}
                {{ script({ add: d3JsFnc.__toString(), dynamic: __oxid_include_dynamic }) }}
            {% endif %}
        {% elseif sVendorFilterDisplayType == 'single' %}
            <input type="hidden" value="" name="d3searchvendormultiselector" id="d3searchvendormultiselector">
        {% elseif sVendorFilterDisplayType == 'multi' %}
            <input type="hidden" value="on" name="d3searchvendormultiselector" id="d3searchvendormultiselector">
        {% endif %}
    {% endblock %}
</div>